{% extends "mainapp/user_profile.html" %}

{% load static %}
{% load widget_tweaks %}


{% block content %}
<main class="translator-main center">
    <form method="post">
        {{ translator_form.media.css }}
        {% csrf_token %}
        <div class="is-flashcard-container">
            <label for="is-flashcard-switch2">Flashcard</label>
            {{ translator_form.is_flashcard|attr:"id:is-flashcard-switch2"}}
            <div class="decks-list">
                {{translator_form.decks|attr:" id:decks-list-selectbox"}}</div>
        </div>
        <input type="hidden" name="form_type" value="translator_form">
        <div class="textareas">
            <div class="textarea-container">
                <textarea id="input-textarea" name="input_text" class="input-box"
                    placeholder="Write the text that you want to translate.">{{input_text}}</textarea>
                <div class="from-languages-container">
                    {{translator_form.from_language|attr:"id:from-language-selectbox"|add_class:"language-selectbox"}}
                </div>
            </div>
            <div class="textarea-container">
                <textarea id="output-textarea" class="output-box"
                    placeholder="Translated text will appear here. Flashcard will be created automatically."
                    readonly>{{ translated_text }}</textarea>
                <div class="to-languages-container">
                    {{translator_form.to_language|attr:"id:to-language-selectbox"|add_class:"language-selectbox"}}
                </div>
            </div>
        </div>
        <button class="translate-button" type="submit">Translate</button>
    </form>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
{{ translator_form.media.js }}

<script>

    // Retrieve input data
    var isFlashcard = document.getElementById("is-flashcard-switch2").checked;
    var fromLanguage = document.getElementById("from-language-selectbox").selectedOptions[0];
    var toLanguage = document.getElementById("to-language-selectbox").selectedOptions[0];

    var selectedDecks = document.getElementById("decks-list-selectbox").selectedOptions;



    var outputTextarea = document.getElementById("output-textarea");



    // AJAX request
    $(document).ready(function () {
        $('.translate-button').click(function (event) {
            event.preventDefault(); // Prevent default form submission
            var selectedDeckValues = [];
            var inputText = document.getElementById("input-textarea").value;
            console.log(inputText);
            for (var i = 0; i < selectedDecks.length; i++) {
                selectedDeckValues.push(selectedDecks[i].textContent);
            }
            console.log(selectedDeckValues);
            var outputTextarea = document.getElementById("output-textarea");
            $.ajax({
                url: '{% url "mainapp:translator" %}',
                data: {
                    'input_text': inputText,
                    'is_flashcard': isFlashcard,
                    'decks': selectedDeckValues,
                    'from_language_symbol': fromLanguage.textContent,
                    'to_language_symbol': toLanguage.textContent,
                },
                dataType: 'json',
                success: function (data) {
                    console.log("success");
                    outputText = data.output_text;
                    outputTextarea.textContent = outputText;
                }
            });
        });
    });


</script>



{% endblock content %}