{% extends "mainapp/landing_page.html" %}

{% block content %}
<!-- Selectbox with decks, visible which one is currently studied -->
<!-- Statiics on how many cards left etc -->
<h2 id="deck-name">{{deck_name}}</h2>
{{flashcards_list}}
<div id="flashcard-container">
    {% if flashcards_list %}
    {{flashcards_list.0.front}}
    <hr>
    <div class="flashcard-back">
        {{flashcards_list.0.back}}
    </div>
    {% else %}
    <p>Congratulations! There is no cards to review in this deck for today!</p>
    {% endif %}
</div>
<button class="show-answer">Flip the card</button>
<div class="quality-buttons-container center">
    <button>Very hard</button>
    <button>Hard</button>
    <button>Ok</button>
    <button>Easy</button>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>

    var flashcardBack = document.querySelector(".flashcard-back");
    var flipCardButton = document.querySelector(".show-answer");
    var qualityButtonsContainer = document.querySelector(".quality-buttons-container");
    var qualityButtons = qualityButtonsContainer.querySelectorAll("button");

    flipCardButton.addEventListener("click", function () { qualityButtonsContainer.style.display = "block"; flipCardButton.style.display = "none"; flashcardBack.style.display = "block" });

    qualityButtons.forEach(button => {
        button.addEventListener("click", function () {
            flipCardButton.style.display = "block";
            qualityButtonsContainer.style.display = "none";
            flashcardBack.style.opacity = "0.5";
        });
    });



    var deckName = document.getElementById("deck-name").textContent;
    console.log(deckName)
    $(document).ready(function () {
        $('.quality-buttons-container button').click(function () {
            var flashcardContainer = $("#flashcard-container");
            console.log(deckName);
            var current_index = 1;
            $.ajax({
                url: '{% url "mainapp:review" %}',
                data: {
                    'deck_name': deckName,
                    'current_index': current_index
                },
                dataType: 'json',
                success: function (data) {
                    flashcardContainer.html(data.front + '<hr>' + '<div class="flashcard-back">' + data.back + '</div>');
                    // Update the displayed card index
                    flashcardContainer.data('index', data.index);
                    var flashcardBack = document.querySelector(".flashcard-back");
                    var flipCardButton = document.querySelector(".show-answer");
                    var qualityButtonsContainer = document.querySelector(".quality-buttons-container");
                    var qualityButtons = qualityButtonsContainer.querySelectorAll("button");

                    flipCardButton.addEventListener("click", function () { qualityButtonsContainer.style.display = "block"; flipCardButton.style.display = "none"; flashcardBack.style.display = "block" });

                    qualityButtons.forEach(button => {
                        button.addEventListener("click", function () {
                            flipCardButton.style.display = "block";
                            qualityButtonsContainer.style.display = "none";
                            flashcardBack.style.opacity = "0.5";
                        });
                    });
                }
            });
        });
    });
</script>
{% endblock content %}