{% extends "mainapp/landing_page.html" %}

{% block content %}
<!-- Selectbox with decks, visible which one is currently studied -->
<!-- Statiics on how many cards left etc -->
<h2 id="deck-name">{{deck_name}}</h2>
{{flashcards_list}}
<div id="flashcard-container">
    {% if flashcards_list %}
    <h3 id="card-id">{{flashcards_list.0.id}}</h3>
    {{flashcards_list.0.front}}
    <hr>
    <div class="flashcard-back">
        {{flashcards_list.0.back}}
    </div>
    {% else %}
    <p>Congratulations! There are no cards to review in this deck for today!</p>
    {% endif %}
</div>
<button class="show-answer">Flip the card</button>
<div class="quality-buttons-container center">
    <button data-quality="0">Very hard</button>
    <button data-quality="1">Hard</button>
    <button data-quality="2">Ok</button>
    <button data-quality="3">Easy</button>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>

    // Initialize elements and assign actions to buttons
    function initializeReviewElements() {
        var flashcardBack = document.querySelector(".flashcard-back");
        var flipCardButton = document.querySelector(".show-answer");
        var qualityButtonsContainer = document.querySelector(".quality-buttons-container");
        var qualityButtons = qualityButtonsContainer.querySelectorAll("button");

        // Actions after clicking Flip Card button
        flipCardButton.addEventListener("click", function () { qualityButtonsContainer.style.display = "block"; flipCardButton.style.display = "none"; flashcardBack.style.display = "block" });

        // Actions after clicking one of quality buttons
        qualityButtons.forEach(button => {
            button.addEventListener("click", function () {
                flipCardButton.style.display = "block";
                qualityButtonsContainer.style.display = "none";
                flashcardBack.style.opacity = "0.5";
            });
        });
    }

    // Execute Initalization
    initializeReviewElements();


    // Retrieve card id and deck name
    var cardId = document.getElementById("card-id").textContent;
    var deckName = document.getElementById("deck-name").textContent;

    // AJAX request
    $(document).ready(function () {
        $('.quality-buttons-container button').click(function () {
            var flashcardContainer = $("#flashcard-container");
            var quality = $(this).data("quality");
            $.ajax({
                url: '{% url "mainapp:review" %}',
                data: {
                    'deck_name': deckName,
                    'id': cardId,
                    'quality': quality
                },
                dataType: 'json',
                success: function (data) {
                    if (data.id == "no more cards") { flashcardContainer.html('<h3>Congratulations! There are nor cards to reveiew in this deck for today!</h3>') }
                    else {
                        cardId = data.id
                        flashcardContainer.html('<h3 id="card-id">' + data.id + '</h3>' + data.front + '<hr>' + '<div class="flashcard-back">' + data.back + '</div>');
                        initializeReviewElements();
                    }
                }
            });
        });
    });

</script>

{% endblock content %}